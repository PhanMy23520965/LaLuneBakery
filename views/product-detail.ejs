<!DOCTYPE html>
<html>
<head>
    <title><%= product.name %> - La Lune Bakery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #F9F7F2; }
        .product-img { width: 100%; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .price-tag { color: #D4A5A5; font-size: 2rem; font-weight: bold; }
        .btn-buy { 
            background-color: #D4A5A5; color: white; border: none; 
            padding: 12px 30px; font-size: 1.2rem; font-weight: bold; width: 100%;
            transition: 0.3s; text-transform: uppercase;
        }
        .btn-buy:hover { background-color: #C08B8B; transform: translateY(-2px); color: white; }
        
        /* CSS Gốc: width cố định gây lỗi rớt dòng */
        /* .info-label { font-weight: bold; color: #555; width: 120px; display: inline-block; } */

        /* CSS Sửa đổi: Bỏ width cố định, dùng padding để căn thẳng hàng */
        .info-label-inline {
            font-weight: bold; color: #555;
            display: inline-block;
            min-width: 130px; /* Đảm bảo đủ rộng cho các nhãn ngắn */
        }
        .info-label-block {
            font-weight: bold; color: #555;
            display: block;
            margin-bottom: 10px;
            width: auto; /* Quan trọng: Để nó tự động mở rộng, không bị rớt dòng */
        }
        
        .cart-badge {
            position: absolute; top: -5px; right: -10px;
            background-color: #ff4757; color: white;
            border-radius: 50%; padding: 4px 8px; font-size: 0.75rem;
        }

        /* --- FIX CHO MOBILE --- */
        @media (max-width: 768px) {
            .container.mt-5 {
                margin-bottom: 80px !important; /* Tăng khoảng cách đáy để không bị sát footer */
            }
            /* Tăng cỡ chữ lên một chút trên mobile cho dễ đọc */
            body { font-size: 16px; }
            .info-label-inline, .info-label-block { font-size: 1.1rem; }
            .price-tag { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    
    <nav class="navbar navbar-expand-lg bg-white shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/" style="color: #D4A5A5;">
                <i class="fas fa-bread-slice me-2"></i>La Lune Bakery
            </a>
            
            <div class="d-flex align-items-center">
                <a href="/" class="btn btn-outline-secondary btn-sm me-3">
                    <i class="fas fa-arrow-left"></i> Tiếp tục mua hàng
                </a>

                <a href="/cart" class="position-relative text-dark fs-5 me-2">
                    <i class="fas fa-shopping-cart" style="color: #D4A5A5;"></i>
                    <% if(user && user.cart && user.cart.length > 0) { %>
                        <span class="cart-badge">
                            <%= user.cart.reduce((sum, item) => sum + item.quantity, 0) %>
                        </span>
                    <% } %>
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-5 mb-5 pb-4">
        
        <% if(locals.message) { %>
            <div class="alert alert-success alert-dismissible fade show shadow-sm mb-4" role="alert" style="border-left: 5px solid #28a745;">
                <i class="fas fa-check-circle me-2"></i> <strong>Thành công!</strong> <%= message %>
                <a href="/cart" class="fw-bold text-success text-decoration-underline ms-2">Xem giỏ hàng ngay</a>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        <% } %>

        <div class="card border-0 shadow-sm p-4 bg-white">
            <div class="row">
                <div class="col-md-5 mb-4 mb-md-0">
                    <img src="<%= product.image %>" class="product-img" alt="<%= product.name %>">
                </div>

                <div class="col-md-7">
                    <h2 class="fw-bold mb-2"><%= product.name %></h2>
                    
                    <div class="p-3 mb-4 rounded" style="background-color: #fff0f0;">
                        <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                            <span class="price-tag"><%= product.price.toLocaleString('vi-VN') %>đ</span>
                            
                            <form action="/add-to-cart" method="POST" style="flex-grow: 1; max-width: 300px;">
                                <input type="hidden" name="productName" value="<%= product.name %>">
                                <input type="hidden" name="price" value="<%= product.price %>">
                                <input type="hidden" name="img" value="<%= product.image %>">
                                
                                <button type="submit" class="btn btn-buy shadow-sm w-100">
                                    <i class="fas fa-cart-plus me-2"></i> Đặt Mua Ngay
                                </button>
                            </form>
                        </div>
                        <div class="mt-3 text-muted small ps-1">
                            <i class="fas fa-shipping-fast text-success me-1"></i> Giao nhanh 2h
                            <span class="mx-2">|</span>
                            <i class="fas fa-shield-alt text-primary me-1"></i> Bảo đảm tươi ngon
                        </div>
                    </div>

                    <h5 class="fw-bold border-bottom pb-2 mb-3" style="color: #D4A5A5;">Thông tin chi tiết</h5>
                    
                    <p class="mb-2"><span class="info-label-inline">Xuất xứ:</span> <%= product.origin || 'Đang cập nhật' %></p>
                    <p class="mb-2"><span class="info-label-inline">Trọng lượng:</span> <%= product.weight || 'Đang cập nhật' %></p>
                    <p class="mb-2"><span class="info-label-inline">Ý nghĩa:</span> <em>"<%= product.meaning || '...' %>"</em></p>
                    <p class="mb-4"><span class="info-label-inline">Thành phần:</span> <%= product.ingredients || 'Đang cập nhật' %></p>
                    
                    <div>
                        <span class="info-label-block">Mô tả sản phẩm:</span>
                        <p class="text-secondary" style="line-height: 1.7;">
                            <%= product.description || 'Chưa có mô tả cho sản phẩm này.' %>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <%- include('footer') %>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>