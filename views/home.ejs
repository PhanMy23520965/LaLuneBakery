<!DOCTYPE html>
<html>
<head>
    <title>La Lune Bakery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="/" style="font-weight: bold; color: var(--main-color); font-size: 1.5rem;">
                La Lune
            </a>
            
            <form class="d-flex mx-auto" action="/#menu" method="GET" style="width: 40%;">
                <input class="form-control me-2 rounded-pill" type="search" name="search" placeholder="Tìm tên bánh..." value="<%= search %>">
                <button class="btn btn-lune rounded-circle" type="submit"><i class="fas fa-search"></i></button>
            </form>

            <div>
                <% if(user) { %>
                    <div class="d-flex align-items-center">
                        <span class="me-3 d-none d-sm-inline-block" style="color: var(--text-color);">
                            Chào, <strong><%= user.fullname || "Khách hàng" %></strong>
                        </span>

                        <!-- Nút Giỏ hàng -->
                        <a href="/cart" class="btn btn-outline-danger me-2 position-relative">
                            <i class="fas fa-shopping-cart"></i>
                            <% if(user.cart && user.cart.length > 0) { %>
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    <%= user.cart.reduce((sum, item) => sum + item.quantity, 0) %>
                                </span>
                            <% } %>
                            </a>

                        <!-- Nút Đăng xuất -->
                        <a href="/logout" class="btn btn-sm btn-outline-secondary" title="Đăng xuất">
                            <i class="fas fa-sign-out-alt"></i> Thoát
                        </a>
                    </div>
                <% } else { %>
                    <a href="/login" class="btn btn-lune">Đăng nhập</a>
                <% } %>
            </div>
        </div>
    </nav>

    <!-- THÔNG BÁO (Nếu có) -->
    <% if(locals.message) { %>
        <div class="container mt-3">
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-check-circle me-2"></i> <%= message %>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        </div>
    <% } %>

    <!-- INTRO -->
    <div class="intro-section text-center py-5" style="background-color: #fdfbf7;">
        <div class="container">
            <div class="mb-3">
                <img src="/images/logo1.png" style="height: 200px; width: auto;" alt="La Lune Logo" onerror="this.style.display='none'">
            </div>

            <h2 class="display-5" style="color: var(--main-color); font-family: 'Times New Roman', serif;">Câu chuyện La Lune</h2>
            <p class="lead mt-3 mx-auto" style="max-width: 700px; font-style: italic; color: #666;">
                "Giống như mặt trăng dịu dàng tỏa sáng giữa màn đêm, mỗi chiếc bánh tại La Lune được làm ra để xoa dịu tâm hồn bạn bằng sự ngọt ngào tinh tế nhất. Chúng tôi không chỉ bán bánh, chúng tôi gói ghém cảm xúc vào từng hương vị."
            </p>
            <hr class="my-4 mx-auto" style="width: 100px; border-top: 3px solid var(--main-color);">
        </div>
    </div>

    <!-- DANH SÁCH BÁNH -->
    <div class="container mt-5 mb-5" id="menu">
        <h3 class="text-center mb-5" style="color: var(--text-color); font-weight: bold; letter-spacing: 1px;">— Menu Món Ngon —</h3>
        
        <% if(products.length === 0) { %>
            <div class="text-center py-5 text-muted">
                <i class="far fa-sad-tear fa-3x mb-3"></i><br>
                Không tìm thấy bánh nào phù hợp :(
            </div>
        <% } %>

        <div class="row">
            <% products.forEach(function(cake) { %>
                <div class="col-md-4 col-sm-6 mb-4">
                    <div class="card card-custom h-100 product-card border-0 shadow-sm">
                        <!-- Ảnh sản phẩm -->
                        <a href="/product/<%= cake._id %>">
                            <div class="img-wrapper" style="height: 250px; overflow: hidden; border-radius: 15px 15px 0 0;">
                                <img src="<%= cake.image %>" class="card-img-top h-100 w-100" style="object-fit: cover;" alt="<%= cake.name %>">
                            </div>
                        </a>
                        
                        <!-- Nội dung thẻ -->
                        <div class="card-body text-center d-flex flex-column justify-content-between p-4">
                            <div>
                                <h5 class="card-title fw-bold">
                                    <a href="/product/<%= cake._id %>" style="text-decoration: none; color: var(--text-color)"><%= cake.name %></a>
                                </h5>
                                <p class="card-text fw-bold fs-5" style="color: var(--main-color)">
                                    <%= cake.price.toLocaleString('vi-VN') %> VNĐ
                                </p>
                            </div>
                            
                            <!-- KHU VỰC 2 NÚT BẤM -->
                            <div class="mt-3 d-flex gap-2">
                                <!-- Nút Chi tiết -->
                                <a href="/product/<%= cake._id %>" class="btn btn-outline-secondary flex-fill" style="border-color: #D4A5A5; color: #D4A5A5;">
                                    Chi tiết
                                </a>

                                <!-- Nút Mua Ngay (Form) -->
                                <form action="/add-to-cart" method="POST" class="flex-fill">
                                    <input type="hidden" name="productName" value="<%= cake.name %>">
                                    <input type="hidden" name="price" value="<%= cake.price %>">
                                    <input type="hidden" name="img" value="<%= cake.image %>">
                                    
                                    <button type="submit" class="btn text-white w-100 fw-bold" style="background-color: #D4A5A5;">
                                        <i class="fas fa-cart-plus"></i> Mua
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>

    <!-- FOOTER -->
    <%- include('footer') %>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>